# История изменений

## [3.3.2] - 2025-08-26

### Добавлено
- **Документация интеграции с БОЛИД** - подробное описание настройки SMTP и интеграции
- **Инструкции по настройке** - пошаговые инструкции для БОЛИД АРМ ОРИОН ПРО
- **Примеры событий** - детальное описание поддерживаемых типов событий БОЛИД
- **Требования и совместимость** - системные требования и совместимость с БОЛИД
- **Примеры использования** - практические сценарии интеграции
- **Файл LICENSE** - MIT лицензия для открытого распространения

### Улучшено
- **README.md** - полностью переработан с фокусом на интеграцию с БОЛИД
- **Описание проекта** - добавлены теги и ключевые слова для поиска
- **Структура документации** - логичная организация информации по разделам
- **Технические детали** - подробная информация о SMTP сервере и настройках

### Технические детали
- Добавлены теги: #БОЛИД #ОРИОН #УРВ #безопасность #мониторинг #telegram
- Описание интеграции: БОЛИД → Email → SMTP → Telegram
- Настройки SMTP: localhost:1025, без шифрования, без аутентификации
- Совместимость: БОЛИД АРМ ОРИОН ПРО версии 2.x, 3.x, 4.x

---

## [3.3.1] - 2025-08-26

### Исправлено
- **Документация** - обновлены README.md и CHANGELOG.md до актуальной версии
- **Версионирование** - исправлена несоответствие версий в документации
- **Описание функций** - добавлена информация о новых возможностях бургер-меню

### Добавлено
- **Документация бургер-меню** - подробное описание системы автоматической установки команд
- **Команда `/update_menu`** - добавлена в документацию для администраторов
- **Многоязычная поддержка** - документирована поддержка русского и английского языков

---

## [3.3.0] - 2025-08-26

### Добавлено
- **Умная система бургер-меню** с автоматической установкой для авторизованных пользователей
- **Команда `/update_menu`** для администраторов - принудительное обновление меню
- **Многоязычная поддержка команд** - автоматическая установка для русского и английского языков
- **Автоматическая установка меню** при авторизации пользователей

### Улучшено
- **Система команд бота** - теперь меню устанавливается автоматически при каждом взаимодействии
- **Логирование меню** - добавлены подробные логи установки и проверки команд
- **Обработка ошибок** - улучшена обработка ошибок при установке команд меню
- **Проверка команд** - добавлена верификация установленных команд после каждой операции

### Технические детали
- Меню автоматически очищается при старте бота
- Команды устанавливаются для всех языков (ru, en) с fallback на основной
- Добавлена функция `clear_bot_menu()` для принудительной очистки
- Добавлена функция `set_authorized_menu()` для установки команд
- Меню устанавливается при: авторизации, добавлении пользователя, команде /start



## [3.2.10] - 2025-07-14

### Улучшено
- Существенно ускорено и доработано завершение приложения по Ctrl-C: теперь планировщик очистки событий и все потоки завершаются быстро и корректно, без задержек.
- Планировщик теперь реагирует на остановку практически мгновенно, даже если находился в ожидании.
- Улучшена обработка сигналов завершения и логирование процесса shutdown.

## [3.2.9] - 2025-07-13

### Fixed
- Фильтр TechnicalLogFilter теперь блокирует DEBUG-сообщения не только в консоли, но и в файле лога при уровне INFO и ниже
- Финальный фикс системы логирования: теперь DEBUG-сообщения не попадают в логи при уровне INFO

## [3.2.8] - 2025-07-13

### Fixed
- Исправлена проблема с появлением DEBUG сообщений в режиме INFO
- Теперь фильтр технических логов корректно блокирует все DEBUG сообщения в не-DEBUG режимах

## [3.2.1] - 2025-01-27

### Изменено
- **Параметр конфигурации логирования** - переименован `backup_count` в `backup_logs_count` для большей ясности
- **Документация** - обновлены README.md и config.example.ini с новым названием параметра
- **Код** - обновлены функции в app/config.py, app/logger.py, app/main.py

### Технические детали
- Параметр `backup_logs_count` в секции `[Logging]` config.ini определяет количество дней хранения логов
- Обратная совместимость: старые конфиги с `backup_count` будут использовать значение по умолчанию (5 дней)

---

## [3.2.0] - 2025-01-27

### Добавлено
- **Комплексная система логирования** с ротацией файлов по дате
- **Цветной вывод в консоль** для различных уровней логирования
- **Запись логов в файлы** с автоматической очисткой старых записей
- **Конфигурируемые настройки логирования** в config.ini
- **Папка log/** с отслеживанием в Git через .gitkeep

### Изменено
- **Система логирования** полностью переработана с использованием RotatingFileHandler
- **main.py** обновлен для использования кастомного логгера вместо basicConfig
- **config.ini** добавлены секции [Logging] с настройками уровней и удержания
- **README.md** обновлен с описанием конфигурации логирования
- **config.example.ini** добавлены примеры настроек логирования

### Технические детали
- Логи сохраняются в формате YYYYMMDD_app.log
- Автоматическое удаление логов старше указанного количества дней
- Поддержка DEBUG, INFO, WARNING, ERROR уровней с цветовой индикацией
- Ротация по дате: новый файл каждый день, перезапись при перезапуске в тот же день

---

## [3.1.0] - 2025-07-13

### Исправлено
- **Проблема с инициализацией базы данных** - исправлена ошибка "Database manager not initialized"
- **Отправка сообщений в Telegram** - восстановлена отправка email событий пользователям
- **Логирование модулей** - добавлена цветовая подсветка для UserManager и Database
- **Уведомления пользователей** - улучшены уведомления об одобрении/отклонении заявок на авторизацию
- **Порядок инициализации** - исправлен порядок создания объектов для корректной работы

### Изменено
- **Архитектура приложения** - убраны глобальные объекты, добавлена передача через аргументы
- **SMTPHandler** - теперь принимает объекты bot и user_manager для корректной работы
- **UserManager** - переписан для работы с объектом DatabaseManager вместо глобального синглтона
- **Логирование** - добавлены цвета для модулей UserManager (CYAN) и Database (BLUE)
- **Уведомления** - улучшены сообщения пользователям при одобрении авторизации

### Удалено
- **Функционал миграции** - удален для ручного управления пользователем
- **Глобальные объекты** - убраны глобальные user_manager и db_manager
- **Неиспользуемые импорты** - очищены неиспользуемые импорты в user_manager.py

### Технические детали
- База данных теперь создается в правильном месте: `db/users.db` в корне проекта
- Добавлены проверки существования базы данных с информативными сообщениями
- Улучшена обработка ошибок при отправке сообщений
- Добавлен метод `get_auth_request_user_id()` для корректной работы уведомлений

---

## [3.0.0] - 2025-07-13

### Добавлено
- **Новая система авторизации** с SQLite базой данных
- **Административное управление** через inline-клавиатуры
- **Команда `/auth`** для запроса авторизации пользователями
- **Команда `/add_user {id}`** для ручного добавления пользователей администраторами
- **Команда `/list_users`** для просмотра списка авторизованных пользователей
- **Система запросов на авторизацию** с отслеживанием статуса
- **Миграция данных** из файлового хранения в SQLite
- **Секция `[Admins]`** в конфигурации для настройки администраторов
- **Секция `[Database]`** в конфигурации для настройки базы данных

### Изменено
- **UserManager** полностью переписан для работы с SQLite
- **Логика авторизации** теперь требует одобрения администратора
- **Хранение фильтров** перенесено в базу данных
- **Структура проекта** обновлена с папкой migrations
- **README.md** обновлен с описанием новой функциональности

### Удалено
- **Старая логика авторизации** с хардкодом пароля
- **Файловое хранение** пользователей и фильтров (заменено на SQLite)

### Технические детали
- База данных: `db/users.db`
- Таблицы: `authorized_users`, `auth_requests`, `user_filters`
- Обратная совместимость: старые файлы txt поддерживаются для миграции
- Резервные копии: автоматически создаются при миграции

### Миграция
Для обновления с версии 2.x выполните:
```bash
python migrations/migrate_to_sqlite.py
```

---

## [2.1.1] - 2024-12-19

### Исправлено
- Улучшена обработка ошибок при отправке сообщений в Telegram
- Исправлена проблема с кодировкой на Windows
- Добавлена дополнительная проверка конфигурации

### Изменено
- Обновлены зависимости в requirements.txt
- Улучшено логирование ошибок

---

## [2.0.2] - 2024-12-15

### Добавлено
- Поддержка фильтрации сообщений по фамилии сотрудника
- Команда `/filter` для установки фильтра
- Команда `/unfilter` для удаления фильтра
- Улучшенное логирование с цветным выводом

### Изменено
- Обновлена структура конфигурации
- Улучшена обработка SMTP сообщений
- Добавлена поддержка Windows с корректным отображением русского языка

---

## [2.0.1] - 2024-12-10

### Добавлено
- Автоматическая установка зависимостей
- Проверка конфигурации при запуске
- Улучшенное логирование

### Исправлено
- Проблемы с кодировкой на Windows
- Ошибки при обработке email сообщений

---

## [2.0.0] - 2024-12-05

### Добавлено
- Поддержка Telegram бота
- Авторизация пользователей
- Пересылка событий из почты в Telegram
- Конфигурация через config.ini

### Изменено
- Полная переработка архитектуры
- Добавлена поддержка Windows
- Улучшена стабильность работы 